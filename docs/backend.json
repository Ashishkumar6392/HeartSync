{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Stores user account information for login and signup.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account. (Primary Key)"
        },
        "email": {
          "type": "string",
          "description": "User's email address for login.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Conversation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Conversation",
      "type": "object",
      "description": "Represents a private conversation between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the conversation. (Primary Key)"
        },
        "participants": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "An array containing the user IDs of the two participants."
        },
        "lastMessage": {
          "type": "object",
          "description": "A snapshot of the last message sent in the conversation, used for previews.",
          "properties": {
            "text": {
              "type": "string",
              "description": "The text content of the last message."
            },
            "timestamp": {
              "type": "string",
              "format": "date-time",
              "description": "The server timestamp of when the last message was sent."
            }
          }
        }
      },
      "required": [
        "id",
        "participants"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a single message within a conversation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message. (Primary Key)"
        },
        "text": {
          "type": "string",
          "description": "The text content of the message."
        },
        "senderId": {
          "type": "string",
          "description": "The user ID of the person who sent the message."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The server timestamp of when the message was sent."
        }
      },
      "required": [
        "id",
        "text",
        "senderId",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. Only the user with the corresponding userId can access this data. Includes denormalized 'userId' for simple security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/conversations/{conversationId}",
        "definition": {
          "entityName": "Conversation",
          "schema": {
            "$ref": "#/backend/entities/Conversation"
          },
          "description": "Stores metadata about a conversation. Access is restricted to participants.",
          "params": [
            {
              "name": "conversationId",
              "description": "The unique identifier for the conversation."
            }
          ]
        }
      },
      {
        "path": "/conversations/{conversationId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores individual messages within a conversation. Access is restricted to conversation participants.",
          "params": [
            {
              "name": "conversationId",
              "description": "The identifier of the parent conversation."
            },
            {
              "name": "messageId",
              "description": "The unique identifier for the message."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure prioritizes security and scalability for the HeartSync dating app, focusing on authorization independence and clear access patterns. The core structure is built around user-owned data and collaborative data with a membership-based access control model. Login/Signup features utilize email/password authentication and anonymous authentication.\n\n**Authorization Independence:**\n\n*   The structure avoids hierarchical `get()` calls in security rules by denormalizing authorization context where necessary. This is especially crucial for collaborative data and ensures that rules can be evaluated without fetching parent document data, simplifying transactions and improving scalability.\n\n**Structural Segregation:**\n\n*   Different data types with different security needs are stored in separate collections. User accounts are stored under `/users/{userId}`, conversations are in `/conversations/{conversationId}`, and messages are in a subcollection. This prevents accidental data exposure and aligns with security rule logic.\n\n**Access Modeling:**\n\n*   **Private Data:** User account information is stored under `/users/{userId}`, which enables path-based authorization. Only the authenticated user with a matching `userId` can access their own data.\n*   **Membership-Based Data:** Conversations and messages use a membership model. The `participants` array in each `/conversations/{conversationId}` document acts as an access control list (ACL). Security rules check if a user's ID is in this array before granting read or write access to the conversation or its messages.\n\n**QAPs Support:**\n\n*   The use of path-based ownership (`/users/{userId}/...`) ensures secure `list` operations. Security rules can easily restrict listing to the current user's data. The membership map pattern also enables secure listing of collaborative data based on membership roles.\n"
  }
}